<!DOCTYPE html>
<html lang="zh-CN" class="no-js">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>联系我们 - TribitHub</title>
    
    <link rel="stylesheet" href="dist/css/style.css">

    <style>
        .form-status {
            margin-top: 16px;
            font-weight: 600;
            font-size: 16px;
            min-height: 24px;
        }
        /* ▼▼▼ 新增：联系信息区域的样式 ▼▼▼ */
        .contact-info-section {
            max-width: 600px;
            margin: 4rem auto 0;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }
        .contact-info-section h3 {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
        }
        .contact-info-section p {
            font-size: 1.1rem;
            color: var(--text-secondary);
            line-height: 1.8;
        }
        .contact-info-section .contact-value {
            font-weight: 600;
            color: var(--text-primary);
        }
        /* ▲▲▲ 样式结束 ▲▲▲ */
    </style>
</head>
<body class="is-boxed has-animations">
    <div class="body-wrap">
        <header class="site-header">
            <div class="container">
                <div class="site-header-inner">
                    <div class="brand header-brand">
                        <h1 class="m-0">
                            <a href="index.html">
                                <span class="header-brand-text">TribitHub</span>
                            </a>
                        </h1>
                    </div>
                    <ul id="headerLinks" class="header-links list-reset">
                        <li><a href="index.html">首页</a></li>
                        <li><a href="pricing.html">我们的介绍</a></li>
                        <li><a href="contact.html">联系我们</a></li>
                        <li><a href="wiki.html">Wiki</a></li>
                        <li><a href="login-user.html">注册/登录</a></li>

                    </ul>
                    <button id="headerToggle" class="header-toggle" aria-label="Menu">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>
            </div>
        </header>

        <main>
            <section class="contact-section section">
                <div class="container">
                    <div class="section-inner">
                        <div class="section-header text-center">
                            <h2 class="section-title mt-0">提交新工单</h2>
                            <p class="section-paragraph">对于复杂的项目需求，我们建议您通过工单系统提交，以便我们系统地跟进。请详细描述您的需求，我们收到后会尽快处理。</p>
                        </div>
                        
                        <div class="contact-wrap">
                            <div class="contact-form" style="margin: 0 auto; max-width: 600px;">
                                <form id="contactForm">
                                    <div class="field">
                                        <label class="label screen-reader-text" for="subject">项目主题</label>
                                        <div class="control">
                                            <input id="subject" class="input" type="text" name="subject" placeholder="工单主题 (例如: '插件功能建议')" required>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <label class="label screen-reader-text" for="message">需求描述</label>
                                        <div class="control">
                                            <textarea id="message" class="textarea" name="message" placeholder="请在这里详细描述您的问题或需求..." rows="8" required></textarea>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <div class="control">
                                            <button class="button button-primary button-block" type="submit">确认提交</button>
                                        </div>
                                    </div>
                                </form>
                                <div id="formStatus" class="form-status"></div>
                            </div>
                        </div>

                        <!-- ▼▼▼ 新增：我们的联系方式区域 ▼▼▼ -->
                        <div class="contact-info-section">
                            <h3>或者，通过以下方式直接联系我们</h3>
                            <p>
                                对于售前咨询或简单问题，欢迎直接联系我们的客服：<br>
                                QQ: <span class="contact-value">122225554</span><br>
                                Email: <span class="contact-value">silenceyuan2018@gmail.com</span>
                            </p>
                            <p style="font-size: 0.9rem; margin-top: 1.5rem;">
                              
                            </p>
                        </div>
                        <!-- ▲▲▲ 区域结束 ▲▲▲ -->

                    </div>
                </div>
            </section>
        </main>

        <footer class="site-footer-minimal">
            <div class="container">
                <div class="footer-copyright">
                    &copy; 2025 TribitHub, 版权所有
                </div>
            </div>
        </footer>
    </div>
    
    <script src="dist/js/auth-ui.js" defer></script>
    <script src="dist/js/nav.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sessionData = localStorage.getItem('supabase.auth.session');
            const form = document.getElementById('contactForm');
            const statusDiv = document.getElementById('formStatus');
            const submitButton = form.querySelector('button');

            if (!sessionData) {
                form.style.display = 'none';
                statusDiv.innerHTML = '请先 <a href="/login-user.html?redirect=/contact.html">登录</a> 后再提交工单。';
                statusDiv.className = 'status-message error-message';
                return;
            }

            const session = JSON.parse(sessionData);
            const accessToken = session.access_token;

            form.addEventListener('submit', async function(event) {
                event.preventDefault();
                const formData = new FormData(form);
                
                statusDiv.textContent = '正在提交...';
                statusDiv.className = 'status-message';
                submitButton.disabled = true;

                try {
                    const response = await fetch('/api/tickets', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${accessToken}`
                        },
                        body: JSON.stringify({
                            subject: formData.get('subject'),
                            message: formData.get('message')
                        })
                    });

                    const result = await response.json();
                    
                    if (response.status === 401) {
                        localStorage.removeItem('supabase.auth.session');
                        throw new Error('您的登录已过期，请重新登录后再试。');
                    }
                    
                    if (!response.ok) {
                        throw new Error(result.error || '提交失败，请稍后重试');
                    }
                    
                    statusDiv.textContent = '您的工单已成功提交！确认邮件已发送至您的邮箱。';
                    statusDiv.className = 'status-message success-message';
                    form.reset();

                } catch (error) {
                    statusDiv.textContent = `提交失败: ${error.message}`;
                    statusDiv.className = 'status-message error-message';
                    if (error.message.includes('过期')) {
                        setTimeout(() => window.location.href = `/login-user.html?redirect=/contact.html`, 3000);
                    }
                } finally {
                    submitButton.disabled = false;
                }
            });
        });
    </script>
</body>
</html>