<!DOCTYPE html>
<html lang="zh-CN" class="no-js">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>联系我们 - TribitHub</title>
    
    <link rel="stylesheet" href="dist/css/style.css">

    <style>
        .form-status {
            margin-top: 16px;
            font-weight: 600;
            font-size: 16px;
            min-height: 24px;
        }
    </style>
</head>
<body class="is-boxed has-animations">
    <div class="body-wrap">
        <header class="site-header">
            <div class="container">
                <div class="site-header-inner">
                    <div class="brand header-brand">
                        <h1 class="m-0">
                            <a href="index.html">
                                <span class="header-brand-text">TribitHub</span>
                            </a>
                        </h1>
                    </div>
                    <ul id="headerLinks" class="header-links list-reset">
                        <li><a href="index.html">首页</a></li>
                        <li><a href="pricing.html">我们的介绍</a></li>
                        <li><a href="contact.html">联系我们</a></li>
                        <li><a href="wiki.html">文档中心</a></li>
                        <li><a href="https://afdian.com/a/Tribit">商城</a></li>
                        <li><a href="login-user.html">注册/登录</a></li>

                    </ul>
                    <button id="headerToggle" class="header-toggle" aria-label="Menu">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                </div>
            </div>
        </header>

        <main>
            <section class="contact-section section">
                <div class="container">
                    <div class="section-inner">
                        <div class="section-header text-center">
                            <h2 class="section-title mt-0">提交新工单</h2>
                            <p class="section-paragraph">对于复杂的项目需求，我们建议您通过工单系统提交，以便我们系统地跟进。请详细描述您的需求，我们收到后会尽快处理。</p>
                        </div>
                        
                        <div class="contact-wrap">
                            <div class="contact-form" style="margin: 0 auto; max-width: 600px;">
                                <form id="contactForm">
                                    <div class="field">
                                        <label class="label screen-reader-text" for="subject">项目主题</label>
                                        <div class="control">
                                            <input id="subject" class="input" type="text" name="subject" placeholder="工单主题 (例如: '插件功能建议')" required>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <label class="label screen-reader-text" for="message">需求描述</label>
                                        <div class="control">
                                            <textarea id="message" class="textarea" name="message" placeholder="请在这里详细描述您的问题或需求..." rows="8" required></textarea>
                                        </div>
                                    </div>
                                    <div class="field">
                                        <div class="control">
                                            <button class="button button-primary button-block" type="submit">确认提交</button>
                                        </div>
                                    </div>
                                </form>
                                <div id="formStatus" class="form-status"></div>
                            </div>
                        </div>


                    </div>
                </div>
            </section>
        </main>

 <footer class="site-footer-advanced">
    <div class="container">
        <div class="footer-content">

            <div class="footer-column">
                <h4>联系我们</h4>
                <ul>

                    <li>
                        QQ: <a href="https://qm.qq.com/cgi-bin/qm/qr?k=YOUR_QQ_QR_CODE_KEY" target="_blank" rel="noopener noreferrer">122225554</a>
                    </li>

                    <li><a href="mailto:silenceyuan2018@gmail.com">电子邮箱</a></li>
                </ul>
            </div>


            <div class="footer-column">
                <h4>加入我们的qq群</h4>
                <ul>
             
                    <li>
                        QQ 交流群: <a href="https://qm.qq.com/q/AjntVB1Hlm" target="_blank" rel="noopener noreferrer">1001623224</a>
                    </li>
  
                    
                </ul>
            </div>


            <div class="footer-column">
                <h4>加入我们的qq频道</h4>
                <ul>
               
                    <li>
                        QQ 频道号: <a href="https://pd.qq.com/s/aqhlvqcnj" target="_blank" rel="noopener noreferrer">pd52700540</a>
                    </li>
                </ul>
            </div>


            <div class="footer-column">
                <h4>关注与支持</h4>
                <ul>
                    <li><a href="https://space.bilibili.com/1944346663" target="_blank" rel="noopener noreferrer">B站: 爱睡的小侠</a></li>
                    <li><a href="https://space.bilibili.com/1134879812" target="_blank" rel="noopener noreferrer">B站: 乐乐呀lele</a></li>
                    <li><a href="https://afdian.com/a/Tribit" target="_blank" rel="noopener noreferrer">爱发电赞助</a></li>
                </ul>
            </div>
            
   
            <div class="footer-column">
                <h4>网站信息</h4>
                <ul>
                    <li><a href="/terms.html">服务条款</a></li>
                    <li><a href="/privacy.html">隐私政策</a></li>
                </ul>
            </div>
        </div>
        
        <div class="footer-bottom">
            <div class="footer-legal-links">
            </div>
            <div class="footer-copyright">
                &copy; 2025 TribitHub, 版权所有
            </div>
        </div>
    </div>
</footer>

    
    <script src="dist/js/auth-ui.js" defer></script>
    <script src="dist/js/nav.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sessionData = localStorage.getItem('supabase.auth.session');
            const form = document.getElementById('contactForm');
            const statusDiv = document.getElementById('formStatus');
            const submitButton = form.querySelector('button');

            if (!sessionData) {
                form.style.display = 'none';
                statusDiv.innerHTML = '请先 <a href="/login-user.html?redirect=/contact.html">登录</a> 后再提交工单。';
                statusDiv.className = 'status-message error-message';
                return;
            }

            const session = JSON.parse(sessionData);
            const accessToken = session.access_token;

            form.addEventListener('submit', async function(event) {
                event.preventDefault();
                const formData = new FormData(form);
                
                statusDiv.textContent = '正在提交...';
                statusDiv.className = 'status-message';
                submitButton.disabled = true;

                try {
                    const response = await fetch('/api/tickets', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${accessToken}`
                        },
                        body: JSON.stringify({
                            subject: formData.get('subject'),
                            message: formData.get('message')
                        })
                    });

                    const result = await response.json();
                    
                    if (response.status === 401) {
                        localStorage.removeItem('supabase.auth.session');
                        throw new Error('您的登录已过期，请重新登录后再试。');
                    }
                    
                    if (!response.ok) {
                        throw new Error(result.error || '提交失败，请稍后重试');
                    }
                    
                    statusDiv.textContent = '您的工单已成功提交！确认邮件已发送至您的邮箱。';
                    statusDiv.className = 'status-message success-message';
                    form.reset();

                } catch (error) {
                    statusDiv.textContent = `提交失败: ${error.message}`;
                    statusDiv.className = 'status-message error-message';
                    if (error.message.includes('过期')) {
                        setTimeout(() => window.location.href = `/login-user.html?redirect=/contact.html`, 3000);
                    }
                } finally {
                    submitButton.disabled = false;
                }
            });
        });
    </script>
</body>
</html>